require('cheeba')(global);

var R = require('../../');

describe('length...', function() {

  it('accurately describes the length of the data model', function() {
    R.iterate([ ]).length().should.equal(0);
    R.iterate([ 1 ]).length().should.equal(1);
    R.iterate([ 1, 2, 3, 4 ]).length().should.equal(4);
  });

  describe('maintains its valitidy after a call to...', function() {

    var gen;
    beforeEach(function() {
      gen = R.iterate([ 1, 2, 3, 4 ]);
    });

    it('next', function() {
      gen.length().should.equal(4);
    });

    it('reverse', function() {
      gen.reverse();
      gen.length().should.equal(4);
    });

    it('reset', function() {
      gen.reset().length().should.equal(4);
    });

    it('deplete', function() {
      gen.deplete().length().should.equal(4);
    });

    it('filter', function() {
      gen.filter(function(v) { return !(v % 2); });
      gen.length().should.equal(2);
    });

    describe('push...', function() {

      describe('at the beginning of the model...', function() {

        it('with a falsy item', function() {
          gen.push(1, [ ]).length().should.equal(4);
          gen.data().should.eql([ 1, 2, 3, 4 ]);
        });

        it('with a single item', function() {
          gen.push(1, [ 5 ]).length().should.equal(5);
          gen.data().should.eql([ 5, 1, 2, 3, 4 ]);
        });

        it('with multiple items', function() {
          gen.push(1, [ 5, 6 ]).length().should.equal(6);
          gen.data().should.eql([ 5, 6, 1, 2, 3, 4 ]);
        });

      });

      describe('before the cursor...', function() {

        beforeEach(function() {
          gen.next(); gen.next(); gen.next();
        });

        it('with a falsy item', function() {
          gen.push(2, [ ]).length().should.equal(4);
        });

        it('with a single item', function() {
          gen.push(2, [ 1.5 ]).length().should.equal(5);
          gen.data().should.eql([ 1, 1.5, 2, 3, 4 ]);
        });

        it('with multiple items', function() {
          gen.push(2, [ 1.5, 1.75 ]).length().should.equal(6);
          gen.data().should.eql([ 1, 1.5, 1.75, 2, 3, 4 ]);
        });

      });

      describe('under the cursor...', function() {

        beforeEach(function() {
          gen.next(); gen.next();
        });

        it('with a falsy item', function() {
          gen.push(2, [ ]).length().should.equal(4);
        });

        it('with a single item', function() {
          gen.push(2, [ 1.5 ]).length().should.equal(5);
          gen.data().should.eql([ 1, 1.5, 2, 3, 4 ]);
        });

        it('with multiple items', function() {
          gen.push(2, [ 1.5, 1.75 ]).length().should.equal(6);
          gen.data().should.eql([ 1, 1.5, 1.75, 2, 3, 4 ]);
        });

      });

      describe('after the cursor...', function() {

        beforeEach(function() {
          gen.next();
        });

        it('with a falsy item', function() {
          gen.push(2, [ ]).length().should.equal(4);
        });

        it('with a single item', function() {
          gen.push(2, [ 1.5 ]).length().should.equal(5);
          gen.data().should.eql([ 1, 1.5, 2, 3, 4 ]);
        });

        it('with multiple items', function() {
          gen.push(2, [ 1.5, 1.75 ]).length().should.equal(6);
          gen.data().should.eql([ 1, 1.5, 1.75, 2, 3, 4 ]);
        });

      });

      describe('at the end of the model...', function() {

        it('with a falsy item', function() {
          gen.push().length().should.equal(4);
          gen.push([ ]).length().should.equal(4);
        });

        it('with a single item', function() {
          gen.push([ 5 ]).length().should.equal(5);
          gen.data().should.eql([ 1, 2, 3, 4, 5 ]);
        });

        it('with multiple items', function() {
          gen.push([ 5, 6 ]).length().should.equal(6);
          gen.data().should.eql([ 1, 2, 3, 4, 5, 6 ]);
        });

      });

    });

    describe('pop...', function() {

      describe('at the beginning of the model...', function() {

        it('with a single item', function() {
          gen.pop(1).should.eql([ 1 ]);
          gen.length().should.equal(3);
          gen.data().should.eql([ 2, 3, 4 ]);
        });

        it('with multiple items', function() {
          gen.pop(1, 3).should.eql([ 1, 2, 3 ]);
          gen.length().should.equal(1);
          gen.data().should.eql([ 4 ]);
        });

      });

      describe('before the cursor...', function() {

        beforeEach(function() {
          gen.next(); gen.next(); gen.next();
        });

        it('with a single item', function() {
          gen.pop(2).should.eql([ 2 ]);
          gen.length().should.equal(3);
          gen.data().should.eql([ 1, 3, 4 ]);
        });

        it('with multiple items', function() {
          gen.pop(2, 2).should.eql([ 2, 3 ]);
          gen.length().should.equal(2);
          gen.data().should.eql([ 1, 4 ]);
        });

      });

      describe('under the cursor...', function() {

        beforeEach(function() {
          gen.next(); gen.next();
        });

        it('with a single item', function() {
          gen.pop(2).should.eql([ 2 ]);
          gen.length().should.equal(3);
          gen.data().should.eql([ 1, 3, 4 ]);
        });

        it('with multiple items', function() {
          gen.pop(2, 2).should.eql([ 2, 3 ]);
          gen.length().should.equal(2);
          gen.data().should.eql([ 1, 4 ]);
        });

      });

      describe('after the cursor...', function() {

        beforeEach(function() {
          gen.next();
        });

        it('with a single item', function() {
          gen.pop(2).should.eql([ 2 ]);
          gen.length().should.equal(3);
          gen.data().should.eql([ 1, 3, 4 ]);
        });

        it('with multiple items', function() {
          gen.pop(2, 2).should.eql([ 2, 3 ]);
          gen.length().should.equal(2);
          gen.data().should.eql([ 1, 4 ]);
        });

      });

      describe('at the end of the model...', function() {

        it('with a falsy item', function() {
          gen.push().length().should.equal(4);
        });

        it('with a single item', function() {
          gen.pop(gen.length()).should.eql([ 4 ]);
          gen.length().should.equal(3);
          gen.data().should.eql([ 1, 2, 3 ]);
        });

        it('with multiple items', function() {
          gen.pop(2, 3).should.eql([ 2, 3, 4 ]);
          gen.length().should.equal(1);
        });

        it('does not pop off the end of the model', function() {
          expect(gen.pop(2, 4)).to.be.undefined;
        });

      });

    });

  });

});
